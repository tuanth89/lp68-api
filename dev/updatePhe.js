/**
 */

const mongoose = require('mongoose');
const config = require('../config');
const _ = require('lodash');
const Q = require("q");
const errors = require('restify-errors');

const PheConfig = require('../src/models/pheConfig');

// establish connection to mongodb
mongoose.Promise = global.Promise;

const options = {
    auth: config.db.auth,
    useNewUrlParser: true,
    autoIndex: true, // Don't build indexes
    reconnectTries: Number.MAX_VALUE, // Never stop trying to reconnect
    reconnectInterval: 500, // Reconnect every 500ms
    poolSize: 10, // Maintain up to 10 socket connections
    // If not connected, return errors immediately rather than waiting for reconnect
    bufferMaxEntries: 0,
    connectTimeoutMS: 10000, // Give up initial connection after 10 seconds
    socketTimeoutMS: 45000, // Close sockets after 45 seconds of inactivity
    family: 4 // Use IPv4, skip trying IPv6
};

mongoose.connect(config.db.uri, options).then(() => {
    console.log(`connect mongodb success`);
}, err => {
    console.err(`connect mongodb error: err = ${err}`);
});

const db = mongoose.connection;

db.on('error', (err) => {
    console.error(err);
    process.exit(1);
});

let pheKhachCu = [
    {
        "15": "10",
        "20": "12",
        "21": "13",
        "22": "13",
        "24": "15",
        "25": "15",
        "26": "15.5",
        "27": "16",
        "30": "18",
        "31": "19",
        "32": "19",
        "33": "20",
        "40": "20",
        "41": "20",
        "42": "20",
        "43": "20",
        "44": "20",
        isNewCustomer: false,
        loanMoneyPack: "1000"
    },
    {
        "15": "20",
        "20": "24",
        "21": "26",
        "22": "26",
        "24": "30",
        "25": "30",
        "26": "31",
        "27": "32",
        "30": "36",
        "31": "38",
        "32": "38",
        "33": "40",
        "40": "40",
        "41": "40",
        "42": "40",
        "43": "40",
        "44": "40",
        isNewCustomer: false,
        loanMoneyPack: "2000"
    },
    {
        "15": "25",
        "20": "30",
        "21": "32",
        "22": "32",
        "24": "37",
        "25": "37",
        "26": "38",
        "27": "40",
        "30": "45",
        "31": "47",
        "32": "47",
        "33": "50",
        "40": "50",
        "41": "50",
        "42": "50",
        "43": "50",
        "44": "50",
        isNewCustomer: false,
        loanMoneyPack: "2500"
    },
    {
        "15": "30",
        "20": "36",
        "21": "39",
        "22": "39",
        "24": "45",
        "25": "45",
        "26": "46",
        "27": "48",
        "30": "54",
        "31": "57",
        "32": "57",
        "33": "60",
        "40": "60",
        "41": "60",
        "42": "60",
        "43": "60",
        "44": "60",
        isNewCustomer: false,
        loanMoneyPack: "3000"
    },
    {
        "15": "35",
        "20": "42",
        "21": "46",
        "22": "46",
        "24": "53",
        "25": "53",
        "26": "54",
        "27": "56",
        "30": "63",
        "31": "67",
        "32": "67",
        "33": "70",
        "40": "70",
        "41": "70",
        "42": "70",
        "43": "70",
        "44": "70",
        isNewCustomer: false,
        loanMoneyPack: "3500"
    },
    {
        "15": "40",
        "20": "48",
        "21": "52",
        "22": "52",
        "24": "60",
        "25": "60",
        "26": "62",
        "27": "64",
        "30": "72",
        "31": "76",
        "32": "76",
        "33": "80",
        "40": "80",
        "41": "80",
        "42": "80",
        "43": "80",
        "44": "80",
        isNewCustomer: false,
        loanMoneyPack: "4000"
    },
    {
        "15": "50",
        "20": "60",
        "21": "65",
        "22": "65",
        "24": "75",
        "25": "75",
        "26": "77",
        "27": "80",
        "30": "90",
        "31": "95",
        "32": "95",
        "33": "100",
        "40": "100",
        "41": "100",
        "42": "100",
        "43": "100",
        "44": "100",
        isNewCustomer: false,
        loanMoneyPack: "5000"
    },
    {
        "15": "60",
        "20": "72",
        "21": "78",
        "22": "78",
        "24": "90",
        "25": "90",
        "26": "93",
        "27": "96",
        "30": "108",
        "31": "114",
        "32": "114",
        "33": "120",
        "40": "120",
        "41": "120",
        "42": "120",
        "43": "120",
        "44": "120",
        isNewCustomer: false,
        loanMoneyPack: "6000"
    },
    {
        "15": "75",
        "20": "90",
        "21": "97",
        "22": "97",
        "24": "112",
        "25": "112",
        "26": "116",
        "27": "120",
        "30": "135",
        "31": "142",
        "32": "142",
        "33": "150",
        "40": "150",
        "41": "150",
        "42": "150",
        "43": "150",
        "44": "150",
        isNewCustomer: false,
        loanMoneyPack: "7500"
    },
    {
        "15": "80",
        "20": "96",
        "21": "104",
        "22": "104",
        "24": "120",
        "25": "120",
        "26": "124",
        "27": "128",
        "30": "144",
        "31": "152",
        "32": "152",
        "33": "160",
        "40": "160",
        "41": "160",
        "42": "160",
        "43": "160",
        "44": "160",
        isNewCustomer: false,
        loanMoneyPack: "8000"
    },
    {
        "15": "100",
        "20": "120",
        "21": "130",
        "22": "130",
        "24": "150",
        "25": "150",
        "26": "155",
        "27": "160",
        "30": "180",
        "31": "190",
        "32": "190",
        "33": "200",
        "40": "200",
        "41": "200",
        "42": "200",
        "43": "200",
        "44": "200",
        isNewCustomer: false,
        loanMoneyPack: "10000"
    },
    {
        "15": "125",
        "20": "150",
        "21": "162",
        "22": "162",
        "24": "187",
        "25": "187",
        "26": "194",
        "27": "200",
        "30": "225",
        "31": "237",
        "32": "237",
        "33": "250",
        "40": "250",
        "41": "250",
        "42": "250",
        "43": "250",
        "44": "250",
        isNewCustomer: false,
        loanMoneyPack: "12500"
    },
    {
        "15": "150",
        "20": "180",
        "21": "195",
        "22": "195",
        "24": "225",
        "25": "225",
        "26": "233",
        "27": "240",
        "30": "270",
        "31": "285",
        "32": "285",
        "33": "300",
        "40": "300",
        "41": "300",
        "42": "300",
        "43": "300",
        "44": "300",
        isNewCustomer: false,
        loanMoneyPack: "15000"
    },
    {
        "15": "175",
        "20": "210",
        "21": "227",
        "22": "227",
        "24": "262",
        "25": "262",
        "26": "271",
        "27": "280",
        "30": "315",
        "31": "332",
        "32": "332",
        "33": "350",
        "40": "350",
        "41": "350",
        "42": "350",
        "43": "350",
        "44": "350",
        isNewCustomer: false,
        loanMoneyPack: "20000"
    },
    {
        "15": "250",
        "20": "300",
        "21": "325",
        "22": "325",
        "24": "375",
        "25": "375",
        "26": "387.5",
        "27": "400",
        "30": "450",
        "31": "475",
        "32": "475",
        "33": "500",
        "40": "500",
        "41": "500",
        "42": "500",
        "43": "500",
        "44": "500",
        isNewCustomer: false,
        loanMoneyPack: "25000"
    },
    {
        "15": "300",
        "20": "360",
        "21": "390",
        "22": "390",
        "24": "450",
        "25": "450",
        "26": "465",
        "27": "480",
        "30": "540",
        "31": "570",
        "32": "570",
        "33": "600",
        "40": "600",
        "41": "600",
        "42": "600",
        "43": "600",
        "44": "600",
        isNewCustomer: false,
        loanMoneyPack: "30000"
    },
    {
        "15": "350",
        "20": "420",
        "21": "454",
        "22": "454",
        "24": "524",
        "25": "524",
        "26": "542",
        "27": "560",
        "30": "630",
        "31": "664",
        "32": "664",
        "33": "700",
        "40": "700",
        "41": "700",
        "42": "700",
        "43": "700",
        "44": "700",
        isNewCustomer: false,
        loanMoneyPack: "40000"
    }
];

let pheKhachMoi = [
    {
        "15": "32",
        "20": "42",
        "21": "45",
        "22": "47",
        "24": "51",
        "25": "53",
        "26": "55",
        "27": "57",
        "30": "64",
        "31": "66",
        "32": "68",
        "33": "70",
        "40": "70",
        "41": "70",
        "42": "70",
        "43": "70",
        "44": "70",
        isNewCustomer: true,
        loanMoneyPack: "1000"
    },
    {
        "15": "64",
        "20": "84",
        "21": "90",
        "22": "94",
        "24": "102",
        "25": "106",
        "26": "110",
        "27": "114",
        "30": "128",
        "31": "132",
        "32": "136",
        "33": "140",
        "40": "140",
        "41": "140",
        "42": "140",
        "43": "140",
        "44": "140",
        isNewCustomer: true,
        loanMoneyPack: "2000"
    },
    {
        "15": "80",
        "20": "105",
        "21": "112",
        "22": "117",
        "24": "127",
        "25": "132",
        "26": "138",
        "27": "142",
        "30": "160",
        "31": "165",
        "32": "170",
        "33": "175",
        "40": "175",
        "41": "175",
        "42": "175",
        "43": "175",
        "44": "175",
        isNewCustomer: true,
        loanMoneyPack: "2500"
    },
    {
        "15": "96",
        "20": "126",
        "21": "134",
        "22": "140",
        "24": "152",
        "25": "158",
        "26": "165",
        "27": "170",
        "30": "192",
        "31": "198",
        "32": "204",
        "33": "210",
        "40": "210",
        "41": "210",
        "42": "210",
        "43": "210",
        "44": "210",
        isNewCustomer: true,
        loanMoneyPack: "3000"
    },
    {
        "15": "112",
        "20": "147",
        "21": "158",
        "22": "165",
        "24": "179",
        "25": "186",
        "26": "193",
        "27": "200",
        "30": "224",
        "31": "231",
        "32": "238",
        "33": "245",
        "40": "245",
        "41": "245",
        "42": "245",
        "43": "245",
        "44": "245",
        isNewCustomer: true,
        loanMoneyPack: "3500"
    },
    {
        "15": "128",
        "20": "168",
        "21": "180",
        "22": "188",
        "24": "204",
        "25": "212",
        "26": "220",
        "27": "228",
        "30": "256",
        "31": "264",
        "32": "272",
        "33": "280",
        "40": "280",
        "41": "280",
        "42": "280",
        "43": "280",
        "44": "280",
        isNewCustomer: true,
        loanMoneyPack: "4000"
    },
    {
        "15": "160",
        "20": "210",
        "21": "225",
        "22": "235",
        "24": "255",
        "25": "265",
        "26": "275",
        "27": "285",
        "30": "320",
        "31": "330",
        "32": "340",
        "33": "350",
        "40": "350",
        "41": "350",
        "42": "350",
        "43": "350",
        "44": "350",
        isNewCustomer: true,
        loanMoneyPack: "5000"
    },
    {
        "15": "192",
        "20": "252",
        "21": "270",
        "22": "282",
        "24": "306",
        "25": "318",
        "26": "330",
        "27": "342",
        "30": "384",
        "31": "396",
        "32": "408",
        "33": "420",
        "40": "420",
        "41": "420",
        "42": "420",
        "43": "420",
        "44": "420",
        isNewCustomer: true,
        loanMoneyPack: "6000"
    },
    {
        "15": "240",
        "20": "315",
        "21": "337",
        "22": "352",
        "24": "382",
        "25": "397",
        "26": "412",
        "27": "427",
        "30": "480",
        "31": "494.99999999999994",
        "32": "510",
        "33": "525",
        "40": "525",
        "41": "525",
        "42": "525",
        "43": "525",
        "44": "525",
        isNewCustomer: true,
        loanMoneyPack: "7500"
    },
    {
        "15": "256",
        "20": "336",
        "21": "360",
        "22": "376",
        "24": "408",
        "25": "424",
        "26": "440",
        "27": "456",
        "30": "512",
        "31": "528",
        "32": "544",
        "33": "560",
        "40": "560",
        "41": "560",
        "42": "560",
        "43": "560",
        "44": "560",
        isNewCustomer: true,
        loanMoneyPack: "8000"
    },
    {
        "15": "320",
        "20": "420",
        "21": "450",
        "22": "470",
        "24": "510",
        "25": "530",
        "26": "550",
        "27": "570",
        "30": "640",
        "31": "660",
        "32": "680",
        "33": "700",
        "40": "700",
        "41": "700",
        "42": "700",
        "43": "700",
        "44": "700",
        isNewCustomer: true,
        loanMoneyPack: "10000"
    },
    {
        "15": "400",
        "20": "525",
        "21": "562",
        "22": "587",
        "24": "637",
        "25": "662",
        "26": "687",
        "27": "712",
        "30": "799.99999999999989",
        "31": "824.99999999999989",
        "32": "850",
        "33": "875",
        "40": "875",
        "41": "875",
        "42": "875",
        "43": "875",
        "44": "875",
        isNewCustomer: true,
        loanMoneyPack: "12500"
    },
    {
        "15": "480",
        "20": "630",
        "21": "675",
        "22": "705",
        "24": "765",
        "25": "795",
        "26": "825",
        "27": "855",
        "30": "960",
        "31": "989.99999999999989",
        "32": "1020",
        "33": "1050",
        "40": "1050",
        "41": "1050",
        "42": "1050",
        "43": "1050",
        "44": "1050",
        isNewCustomer: true,
        loanMoneyPack: "15000"
    },
    {
        "15": "640",
        "20": "840",
        "21": "900",
        "22": "940",
        "24": "1020",
        "25": "1060",
        "26": "1100",
        "27": "1140",
        "30": "1280",
        "31": "1320",
        "32": "1360",
        "33": "1400",
        "40": "1400",
        "41": "1400",
        "42": "1400",
        "43": "1400",
        "44": "1400",
        isNewCustomer: true,
        loanMoneyPack: "20000"
    },
    {
        "15": "800",
        "20": "800",
        "21": "800",
        "22": "800",
        "24": "800",
        "25": "800",
        "26": "800",
        "27": "800",
        "30": "800",
        "31": "800",
        "32": "800",
        "33": "800",
        "40": "800",
        "41": "800",
        "42": "800",
        "43": "800",
        "44": "800",
        isNewCustomer: true,
        loanMoneyPack: "25000"
    },
    {
        "15": "960",
        "20": "1260",
        "21": "1350",
        "22": "1410",
        "24": "1530",
        "25": "1590",
        "26": "1650",
        "27": "1710",
        "30": "1920",
        "31": "1980",
        "32": "2040",
        "33": "2100",
        "40": "2100",
        "41": "2100",
        "42": "2100",
        "43": "2100",
        "44": "2100",
        isNewCustomer: true,
        loanMoneyPack: "30000"
    },
    {
        "15": "1280",
        "20": "1680",
        "21": "1800",
        "22": "1880",
        "24": "2040",
        "25": "2120",
        "26": "2200",
        "27": "2280",
        "30": "2560",
        "31": "2640",
        "32": "2720",
        "33": "2800",
        "40": "2800",
        "41": "2800",
        "42": "2800",
        "43": "2800",
        "44": "2800",
        isNewCustomer: true,
        loanMoneyPack: "40000"
    }
];

let dropPheConfig = function () {
    const deferred = Q.defer();

    PheConfig.remove({}, function (error) {
        if (error) {
            console.error(error);
            deferred.reject(
                new errors.InvalidContentError(error.message)
            );
        } else {
            deferred.resolve(true);
        }
    });

    return deferred.promise;
};

db.once('open', () => {
    Promise.all([dropPheConfig()]).then(function (results) {
        PheConfig.insertMany(pheKhachCu)
            .then((result) => {
                // console.log("result ", result);
            })
            .catch(err => {
                console.error("error ", err);
            });

        PheConfig.insertMany(pheKhachMoi)
            .then((result) => {
                // console.log("result ", result);
            })
            .catch(err => {
                console.error("error ", err);
            });
    });
});
